{#
  Partial Parameters:

  checkoutMode: true/false
  hideCouponCode: true/false
  order: if given, will show items from the order instead of from the cart
#}

{# Can't pass in params when reloading partial, so check if current page is checkout. #}
{% if page.url == '/checkout' %}
  {% set checkoutMode = true %}
{% endif %}

{{ open_form({
     'class': 'grid-x grid-padding-x',
     'data-ajax-handler': 'shop:cart',
     'data-ajax-update': checkoutMode
        ? '.cart-contents=cart-contents,.checkout-totals=checkout-totals,.cart-count=cart-count,.mini-cart=mini-cart'
        : '.cart-page=cart-page,.cart-count=cart-count,.mini-cart=mini-cart'
   })
}}
  <header class="cell contents-header">
    <div class="grid-x grid-padding-x">

      <div class="cell">
        <span><strong>Item</strong></span>
      </div>

      <div class="cell number-cell">
        <span><strong>Quantity</strong></span>
      </div>

      <div class="cell number-cell">
        <span><strong>Price</strong></span>
      </div>

      <div class="cell number-cell">
        <span><strong>Total</strong></span>
      </div>

    </div>
  </header>

  {% for item in (order ? order.orderItems : items) %}
  <section class="cell contents-product">
    <div class="grid-x grid-padding-x">

      <header class="cell large-8 clearfix">
        <img class="product-image" src="{{ item.product.images.first.thumbnail(100, 'auto') }}"/>
        <h2 class="product-name"><a href="/product/{{ item.product.url_name }}">{{ item.product.name }}</a></h2>

        {% set options = item.optionsString() %}
        {% if options %}
        <p class="product-options">{{ options | unescape }}</p>
        {% endif %}
        {% set extras = "" %}
        {% for extra in item.extras %}
        {% set extras = extras ~ extra.name ~ (not loop.last ? ', ' : '') %}
        {% endfor %}
        {% if extras | length > 0 %}
        <p class="product-extras">{{ extras }}</p>
        {% endif %}
      </header>

      <div class="cell number-cell">
        {% if checkoutMode %}
        <span class="number-cell-label">Quantity: </span>
        <span class="product-quantity">{{ item.quantity | number_format(0) }}</span>
        {% else %}
        <label>
          <span class="number-cell-label">Quantity: </span>
          <input name="item_quantity[{{ item.key }}]" type="number" min="1" value="{{ item.quantity }}"/>
        </label>
        {% endif %}
      </div>

      <div class="cell number-cell">
        <span class="number-cell-label">Price: </span>
        {% if item.price() != item.fullPrice() %}
        <span class="product-price-original">{{ item.fullPrice() | currency }}</span><br class="show-for-medium">
        {% endif %}

        <span class="product-price-current">{{ item.price() | currency }}</span>
      </div>

      <div class="cell number-cell">
        <span class="number-cell-label">Total: </span>
        {{ item.total() | currency }}
      </div>

      {% if not checkoutMode %}
      <div class="cell remove-cell">
        <a class="remove-button" data-ajax-handler="shop:cart"
           data-ajax-extra-fields="delete_item={{ item.key }}"
           data-ajax-update=".cart-page=cart-page,.cart-count=cart-count,.mini-cart=mini-cart">
          <span class="fa fa-lg fa-times-circle"></span>
        </a>
      </div>
      {% endif %}

    </div>
  </section>
  {% else %}
  <section class="cell contents-product">
    <p class="empty-cart">You don't have anything in your cart yet!</p>
  </section>
  {% endfor %}

  {% if not hideCouponCode %}
  <footer class="cell large-6 large-offset-6 contents-footer">
    <label class="input-group">
      <span class="input-group-label">Coupon Code</span>
      <input type="text" name="coupon" class="input-group-field" value="{{ coupon_code }}"/>
    </label>
    <input type="submit" class="button" value="Apply Changes"/>
  </footer>
  {% endif %}
{{ close_form() }}